---
title: 'MA50258 Lab 1: Solutions'
output:
  html_document:
    number_sections: no
    toc: yes
    toc_float: yes
    toc_depth: 2
    code_download: yes
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE, message = FALSE, warning = TRUE)
# The option warning = FALSE supresses all the output warnings! 
# You can  override this option in each code chunk as shown in some cases below!
```

You can download the `*.Rmd` version of this page by clicking in the **Code button** at the top right of this page. If the **Code button** does not work you can download the 'Lab1.Rmd' file from the Moodle page. You should use RStudio,

# Packages

Below is the list of packages that we will use in this lab.

```{r}
#| message: false
library(tidyverse) 
library(janitor) # to clean names in a data frame
library(kableExtra) # for nicer tables
library(ggplot2)
```

# Gapminder data set

This data set was introduced in [Section 2.3](https://github.bath.ac.uk/pages/kai21/MA50258-lecture-notes/02-intro-tidyverse.html#sec-gapminder-data) of the lecture notes.

The `gapminder` tibble contains a dataset of economic social indicators such as gross domestic product (gdp) per capita, population and life expectancy of many countries over the period from 1952 to 2007 in increments of 5 years.

The data frame `gapminder` has 1704 rows and 6 variables:

-   `country` A factor with 142 levels (eg 142 countries in the data set)

-   `continent` A factor with 5 levels

-   `year` An integer vector with years ranging from 1952 to 2007 in increments of 5 years.

-   `lifeExp` life expectancy at birth, in years

-   `pop` Total population

-   `gdpPercap` GDP per capita (US dollars, inflation-adjusted)

The data can be loaded into `R` using the following command:

```{r,message=FALSE}
library(gapminder)
library(janitor)
gapminder <- clean_names(gapminder)
```

Have a quick glimpse of the data:

```{r}
glimpse(gapminder)
```

Note that each row in `gapminder` refers to an specific country in a specific year.

# Questions

## Instructions

1.  To answer the following questions, simply fill in the code chunks with your own code.

2.  You should use the `dplyr` verbs introduced in [Chapter 2](https://github.bath.ac.uk/pages/kai21/MA50258-lecture-notes/02-intro-tidyverse.html) of the lecture notes as well as the `ggplot` commands introduced in [Chapter 3](https://github.bath.ac.uk/pages/kai21/MA50258-lecture-notes/03-intro-ggplot.html) of the lecture notes.

3.  Once you complete your answers, knit the corresponding Rmarkdown (`.Rmd`) document to produce an HTML file. The name of the HTML file should be Lab1.html.

4.  If the answer is a data frame then you can turn it into a table using the following command.

```{r}


gapminder %>% 
  slice_head(n =6) %>% 
     kable(caption = "First six rows of the gapminder data base",
           digits  = 2) %>% 
      kable_styling(bootstrap_options = "striped", 
                    full_width        = F )

```

## Question 1

Find the 10 countries with lowest GDP per capita:

a.  In the whole data base\
b.  In 1977
c.  In Africa in 1977

Display each result in a table.

```{r}
# Your code answer here
q1a <- gapminder %>% arrange(gdp_percap) %>% distinct(country, .keep_all = TRUE) %>% slice(1:10)
q1a
```

```{r}
q1b <- filter(.data = gapminder, year == "1977") %>% arrange(gdp_percap) %>% slice(1:10)
q1b
```

```{r}
q1c <- filter(.data = gapminder, year == "1977", continent == "Africa") %>% arrange(gdp_percap) %>% distinct(country, .keep_all = TRUE) %>%  slice(1:10)
q1c
```

```{r}
### Lecturer's solution
#gapminder
#  slice_min(gdp_Percap, n = 10) |>
#  select(country, continent, year, gdp_Percap) |>
#  kable(caption = "Countries with overall lowest GDP per capita", digit = 2,
#        col.names = c("Country","Continent","year","GDP per capita")) |> kable_styling(bootstrap_options = "striped", full_width = F)
```

## Question 2

Use `group_by` and `summarise` to find the average and median GDP per capita in each continent in 2007. Also find the corresponding difference between mean and median (which is an indication of skewness). Display the results in a table.

```{r}
# Your code answer here
q2 <- filter(.data = gapminder, year == "2007") %>%
  group_by(continent) %>%
    summarise(
      mean = mean(gdp_percap),
      median = median(gdp_percap)
  ) %>%  mutate("difference(skewness)" = mean - median) %>% 
kable(caption = "GDP per capita in 2007",
      digits = 2,
      col.names = c("Continent", "Mean", "Median", "Difference   (skewness)")) %>%
  kable_styling(bootstrap_options = "striped",
                full_width = F
  )
q2
```

## Question 3

Display a scatter plot of GDP per capita (x) against life expectancy (y) in 2007 but differentiating countries in Europe with a different colour than the rest of the world. You should label the axes appropriately as well as produce informative labels for the colours.

```{r}
# Your code answer here
ggplot(data <- gapminder %>%
         filter(year == 2007) %>%
         mutate(continent = ifelse(continent == "Europe", "Europe", "Rest of the World")),
       mapping = aes(x = gdp_percap,
                     y = life_exp)) +
  geom_point(mapping = aes(colour = continent)) +
  scale_colour_manual(values = c("Europe" = "red",
                                 "Rest of the World" = "grey")) +
  labs(x = "GDP per Capita", 
       y = "Life Expectancy") +
  ggtitle("GDP per capita vs Life Expectancy in 2007") +
  labs(colour = "Continent")
```

## Question 4

Use `facet_grid` to display separate scatter plots of GDP per capita (x) against life expectancy (y) in 2007 corresponding to different continents. You should label the axes appropriately

```{r}
# Your code answer here
ggplot(data = gapminder %>%
         filter(year == 2007),
       mapping = aes(x = gdp_percap,
                     y = life_exp)) +
  geom_point(mapping = aes(colour = continent)) +
  labs(x = "GDP per Capita", y = "Life Expectancy") +
  ggtitle("GDP per Capita vs Life Expectancy in 2007") +
  facet_grid(~continent)

```
