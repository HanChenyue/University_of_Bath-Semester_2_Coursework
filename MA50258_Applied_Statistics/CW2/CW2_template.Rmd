---
title: "MA50258 Applied Statistics: Coursework 2"
author: "09618"
output:
  html_document:
    number_sections: no
    toc: yes
    toc_float: yes
    code_folding: hide
    code_download: yes
---

### Disclaimer:

ChatGPT and GitHub CoPilot used for code and discussion suggestions, debugging purpose, and to check the correctness of the code.

---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE,warning = FALSE, message = FALSE)
```

```{r libraries,echo= FALSE}
# include your libraries here
# use echo = FALSE if you do not want the Code button to appear 
library(tidyverse)
library(modelr)
library(readr)
library(here)

# Load external libraries
library(dplyr)
library(janitor)
library(ggplot2)
library(kableExtra)
library(MASS)
library(broom)
library(stats)
library(effects)
```

```{r,message=FALSE}
# read in the data
sdg <- read_csv(here("data", "sdg.csv"))
Wine <- read_csv(here("data", "Wine.csv"))
```



```{=html}
<!--
You can include non-coding comments using these delimiters. What is written inside these delimiters wont be knitted into the html document!

Do not change the structure of the document, just fill in the sections as indicated 
You can only change the headings indicated with [*]
-->
```
# Sustainable development goals (SDG) data

## Cleaning the dataset

```{r}
# Use janitor to clean the data
sdg_clean <- sdg %>%
  clean_names() %>%
  remove_empty(c("rows", "cols")) %>% 
  drop_na()
```

## Performing exploratory data analysis

```{r}
# Check the structure of the data
# str(sdg_clean)
```


```{r}
# Plot the distribution of infant mortality rate
ggplot(data = sdg_clean, aes(x = infant_mortality_rate)) +
  geom_histogram(aes(y = ..density..), binwidth = 5, fill = "yellow", colour = "gray") +
  geom_density(colour = "red", size = 1) +
  ggtitle("Distribution of Infant Mortality Rate") +
  xlab("Infant Mortality Rate") +
  ylab("Density")
```
```{r, fig.width = 12, fig.height = 12}
# Plot the infant mortality rate by country
ggplot(data = sdg_clean, aes(x = country, y = infant_mortality_rate, fill = country)) +
  geom_bar(stat = "identity") +
  theme(axis.text.x = element_text(angle = 90, hjust = 1), legend.position = "bottom") +
  labs(title = "Infant Mortality Rate by Country", x = "Country", y = "Infant Mortality Rate")
```

Distribution of Infant Mortality Rate

The histogram shows that the distribution of infant mortality rate is right-skewed. This implies that most countries have low-to-moderate infant mortality rates, while a few have higher rates. When we take a look at the bar plot of infant mortality rate by country, we can see that the distribution is consistent with the histogram. The bar plot shows the infant mortality rate for each country, with some countries having higher rates than others.

```{r}
# Use qqplot to check the distribution of infant mortality rate
qqnorm(sdg_clean$infant_mortality_rate)
qqline(sdg_clean$infant_mortality_rate)
```

Given the skewness in both the histogram and qq-plot, a Poisson or Negative Binomial distribution may be appropriate for GLM modelling at a later section.

But we first explore the relationship between infant mortality rate and other variables such as income class, years of education, life expectancy, and GDP per capita.

```{r}
ggplot(data = sdg_clean, aes(x = years_education, y = infant_mortality_rate)) +
  geom_point(alpha = 0.5) +
  geom_smooth(method = "lm", se = F, colour = "blue") +
  ggtitle("Years of Education vs. Infant Mortality Rate") +
  xlab("Years of Education") +
  ylab("Infant Mortality Rate")

ggplot(data = sdg_clean, aes(x = life_expectancy, y = infant_mortality_rate)) +
  geom_point(alpha = 0.5) +
  geom_smooth(method = "lm", se = F, colour = "blue") +
  ggtitle("Life Expectancy vs. Infant Mortality Rate") +
  xlab("Life Expectancy") +
  ylab("Infant Mortality Rate")

ggplot(data = sdg_clean, aes(x = gdp, y = infant_mortality_rate)) +
  geom_point(alpha = 0.5) +
  geom_smooth(method = "loess", se = FALSE, colour = "red") +
  ggtitle("GDP vs. Infant Mortality Rate") +
  xlab("GDP per Capita in USD") +
  ylab("Infant Mortality Rate")

# log the GDP values
ggplot(data = sdg_clean, aes(x = log10(gdp), y = infant_mortality_rate)) +
  geom_point(alpha = 0.5) +
  geom_smooth(method = "lm", se = F, colour = "blue") +
  ggtitle("log10(GDP) vs. Infant Mortality Rate") +
  xlab("log10(GDP per Capita in USD)") +
  ylab("Infant Mortality Rate")

# GDP vs. Infant Mortality Rate for each continent
ggplot(data = sdg_clean, aes(x = log10(gdp), y = infant_mortality_rate, colour = continent)) +
  geom_point(alpha = 0.5) +
  # geom_smooth(method = "loess", se = FALSE) +
  facet_wrap(~continent) +
  ggtitle("GDP vs. Infant Mortality Rate by Continent") +
  xlab("log10(GDP per Capita in USD)") +
  ylab("Infant Mortality Rate")

# GDP vs. Infant Mortality Rate for each income class
ggplot(data = sdg_clean, aes(x = log10(gdp), y = infant_mortality_rate, colour = income_class)) +
  geom_point(alpha = 0.5) +
  # geom_smooth(method = "loess", se = FALSE) +
  facet_wrap(~income_class) +
  ggtitle("GDP vs. Infant Mortality Rate by Income Class") +
  xlab("log10(GDP per Capita in USD)") +
  ylab("Infant Mortality Rate")
```

As shown above:

- As years of education increase, infant mortality rates tend to decrease. This suggests that education may play a role in reducing infant mortality rates. A simple linear regression model $E(\text{Infant Mortality Rate | Years of Education}) = \beta_0 + \beta_1 \times \text{Years of Education}$ has shown that the decrease is linear.

- As life expectancy increases, infant mortality rates tend to decrease. This is consistent with the idea that better healthcare and living conditions can lead to lower infant mortality rates. A simple linear regression model $E(\text{Infant Mortality Rate | Life Expectancy}) = \beta_0 + \beta_1 \times \text{Life Expectancy}$ has shown that the decrease is linear.

- As GDP per capita increases, infant mortality rates tend to decrease. This suggests that wealthier countries tend to have lower infant mortality rates. The relationship is not strictly linear, as the LOESS curve shows that the decrease is more pronounced at lower GDP levels (around USD $25000) but levels off after that. By log-transforming the GDP values, we can see a clearer linear relationship between GDP and infant mortality rates as shown by a simple linear regression model $E(\text{Infant Mortality Rate | GDP}) = \beta_0 + \beta_1 \times \text{log10(GDP)}$ that the decrease is linear.

- The facet plot of GDP vs. Infant Mortality Rate by continent shows that the relationship between GDP and infant mortality rate varies by continent. In Africa, the the infant mortality rate concentration is high, Asia has a mixed infant mortality rate concentration, America has a moderately low infant mortality rate concentration, and Europe and Oceania have the least infant mortality rate concentrations.

- The facet plot of GDP vs. Infant Mortality Rate by income class shows that the relationship between GDP and infant mortality rate varies by income class. The 'H' (high) income class countries have the lowest infant mortality rates concentration, while the 'UM' (upper-middle) income class countries have mixed level of infant mortality rates concentration. 'LM' (lower-middle) income class countries has a mixed infant mortality rate concentration as a noticeable proportion of countries seems to have high infant mortality rate concentration, and 'L' (low) income class countries have the highest infant mortality rate concentration.

Next, we explore the relationship between income class and infant mortality rate.

```{r}
# Income Class vs. Infant Mortality Rate
ggplot(data = sdg_clean, aes(x = income_class, y = infant_mortality_rate, fill = income_class)) +
  geom_boxplot(colour = "black") +
  scale_fill_manual(values = c("H" = "yellow", "UM" = "orange", "LM" = "red", "L" = "magenta")) +
  ggtitle("Income Class vs. Infant Mortality Rate") +
  xlab("Income Class") +
  ylab("Infant Mortality Rate")
```

```{r}
# Show the top 10 countries with the lowest infant mortality rates and their respective income classes and vice versa
sdg_clean %>%
  arrange(infant_mortality_rate) %>%
  head(10) %>%
  dplyr::select(country, infant_mortality_rate, income_class) %>%
  kable(caption = "Top 10 countries with the lowest infant mortality rates") %>%
  kable_styling(full_width = F)
```

```{r}
# Show the bottom 10 countries with the highest infant mortality rates and their respective income classes
sdg_clean %>%
  arrange(desc(infant_mortality_rate)) %>%
  dplyr::select(country, infant_mortality_rate, income_class) %>%
  head(10) %>%
  kable(caption = "Top 10 countries with the highest infant mortality rates") %>%
  kable_styling(full_width = F)
```

Infant Mortality Rate by Country:

The bar plot displays the infant mortality rate for each country. There is a clear pattern in that as income class decrease from 'H' (upper) income class to 'L' (low) income class, the infant mortality rate tends to increase.

This is also shown that the table that the top 10 countries with the lowest infant mortality rates are all classified as 'H' (upper) income class countries. Conversely, the bottom 10 countries with the highest infant mortality rates are classified as 'L' (low) or 'LM" (low-middle) income class countries. This suggests a strong relationship between income class and infant mortality rate, while also highlight that as income class decreases to 'L' or 'LM', the infant mortality rate will likely increase.

## Regression models

Next, we attempt to find the best linear model to predict infant mortality rate using years of education, GDP per capita, and life expectancy as predictors. Given there are multiple combinations possible, we first start with 7 models and use AIC and R-squared values to determine the best model before checking the significance of the predictors.

- Model 1: $$E(\text{Infant Mortality Rate | Years of Education}) = \beta_0 + \beta_1 \times \text{Years of Education}$$

- Model 2: $$E(\text{Infant Mortality Rate | Years of Education, GDP}) = \beta_0 + \beta_1 \times \text{Years of Education} + \beta_2 \times \text{log10(GDP)}$$

- Model 3: $$E(\text{Infant Mortality Rate | Years of Education, GDP, Life Expectancy}) = \beta_0 + \beta_1 \times \text{Years of Education} + \beta_2 \times \text{log10(GDP)} + \beta_3 \times \text{Life Expectancy}$$

- Model 4: $$
\begin{array}{rcl}
E(\text{Infant Mortality Rate | Years of Education, GDP, Life Expectancy}) &=& \beta_0 + \beta_1 \times \text{Years of Education} + \beta_2 \times \text{log10(GDP)} + \beta_3 \times \text{Life Expectancy}\\
&& + \beta_4 \times \text{Years of Education} \times \text{log10(GDP)}
\end{array}
$$

- Model 5: $$
\begin{array}{rcl}
E(\text{Infant Mortality Rate | Years of Education, GDP, Life Expectancy}) &=& \beta_0 + \beta_1 \times \text{Years of Education} + \beta_2 \times \text{log10(GDP)} + \beta_3 \times \text{Life Expectancy}\\
&& + \beta_4 \times \text{Years of Education} \times \text{Life Expectancy}
\end{array}
$$

- Model 6: $$
\begin{array}{rcl}
E(\text{Infant Mortality Rate | Years of Education, GDP, Life Expectancy}) &=& \beta_0 + \beta_1 \times \text{Years of Education} + \beta_2 \times \text{log10(GDP)} + \beta_3 \times \text{Life Expectancy}\\
&& + \beta_4 \times \text{log10(GDP)} \times \text{Life Expectancy}
\end{array}
$$

Model 7: $$
\begin{array}{rcl}
E(\text{Infant Mortality Rate | Years of Education, GDP, Life Expectancy}) &=& \beta_0 + \beta_1 \times \text{Years of Education} + \beta_2 \times \text{log10(GDP)} + \beta_3 \times \text{Life Expectancy}\\
&& + \beta_4 \times \text{Years of Education} \times \text{log10(GDP)}\\
&& + \beta_5 \times \text{Years of Education} \times \text{Life Expectancy}\\
&& + \beta_6 \times \text{log10(GDP)} \times \text{Life Expectancy}\\
&& + \beta_7 \times \text{Years of Education} \times \text{log10(GDP)} \times \text{Life Expectancy}\\
\end{array}
$$



```{r}
# Using AIC and R-squared to determine the best model
task1_lm_model_1 <- lm(infant_mortality_rate ~ years_education, data = sdg_clean)
task1_lm_model_2 <- lm(infant_mortality_rate ~ years_education + log10(gdp), data = sdg_clean)
task1_lm_model_3 <- lm(infant_mortality_rate ~ years_education + log10(gdp) + life_expectancy, data = sdg_clean)
task1_lm_model_4 <- lm(infant_mortality_rate ~ years_education + log10(gdp) + life_expectancy + years_education * log10(gdp), data = sdg_clean)
task1_lm_model_5 <- lm(infant_mortality_rate ~ years_education + log10(gdp) + life_expectancy + years_education * life_expectancy, data = sdg_clean)
task1_lm_model_6 <- lm(infant_mortality_rate ~ years_education + log10(gdp) + life_expectancy + log10(gdp) * life_expectancy, data = sdg_clean)
task1_lm_model_7 <- lm(infant_mortality_rate ~ years_education + log10(gdp) + life_expectancy + years_education * log10(gdp) * life_expectancy, data = sdg_clean)

# Generate a table with AIC and R-squared values
kable(data.frame(Model = c("Model 1", "Model 2", "Model 3", "Model 4", "Model 5", "Model 6", "Model 7"),
                 AIC = c(AIC(task1_lm_model_1), AIC(task1_lm_model_2), AIC(task1_lm_model_3), AIC(task1_lm_model_4), AIC(task1_lm_model_5), AIC(task1_lm_model_6), AIC(task1_lm_model_7)),
                 R_squared = c(summary(task1_lm_model_1)$r.squared, summary(task1_lm_model_2)$r.squared, summary(task1_lm_model_3)$r.squared, summary(task1_lm_model_4)$r.squared, summary(task1_lm_model_5)$r.squared, summary(task1_lm_model_6)$r.squared, summary(task1_lm_model_7)$r.squared))) %>% 
  kable_styling(full_width = F)
```

Given Model 7 has the lowest AIC value and the highest R-squared value, thus far, it is the best model to predict infant mortality rate using years of education, GDP per capita, life expectancy, and income class as predictors.

Model 7: $$
\begin{array}{rcl}
E(\text{Infant Mortality Rate | Years of Education, GDP, Life Expectancy}) &=& \beta_0 + \beta_1 \times \text{Years of Education} + \beta_2 \times \text{log10(GDP)} + \beta_3 \times \text{Life Expectancy}\\
&& + \beta_4 \times \text{Years of Education} \times \text{log10(GDP)}\\
&& + \beta_5 \times \text{Years of Education} \times \text{Life Expectancy}\\
&& + \beta_6 \times \text{log10(GDP)} \times \text{Life Expectancy}\\
&& + \beta_7 \times \text{Years of Education} \times \text{log10(GDP)} \times \text{Life Expectancy}\\
\end{array}
$$

However, we can check whether the effects are statistically significant by examining if the p-value is less than 0.05

```{r}
model_7_summary <- tidy(task1_lm_model_7)

# Subset to keep only the estimate and p-value columns
model_7_summary_subset <- model_7_summary[, c("term", "estimate", "p.value")]
# 
# # Round the estimate to 2 significant figures and format the p-value
# model_7_summary_subset$estimate <- signif(model_7_summary_subset$estimate, digits = 2)
# model_7_summary_subset$p.value <- formatC(model_7_summary_subset$p.value, format = "e", digits = 2)

# Change the names
model_7_summary_subset$term <- c("Intercept", "Years of Education", "log(GDP)", "Life Expectancy", "Interaction: Years of Education & log(GDP)", "Interaction: Years of Education & Life Expectancy", "Interactions: log(GDP) & Life Expectancy", "Interactions: Years of Education & log(GDP) & Life Expectancy")

# Use kable to create a nicely formatted table
kable(model_7_summary_subset, format = "html", digits = 4) %>%
  kable_styling(bootstrap_options = c("striped", "hover"))
```

It has shown that 'life_expectancy' is not statistically significant as their p-values are greater than 0.05.

Thus, we can simplify the model to:

Final Model:

$$
\begin{array}{rcl}
E(\text{Infant Mortality Rate | Years of Education, GDP}) &=& \beta_0 + \beta_1 \times \text{Years of Education} +  \beta_2 \times \text{log10(GDP)}\\
&& + \beta_4 \times \text{Years of Education} \times \text{log10(GDP)}
\end{array}
$$

```{r}
task1_lm_model_final <- lm(infant_mortality_rate ~ years_education + log10(gdp) + years_education * log10(gdp), data = sdg_clean)

final_model_summary <- tidy(task1_lm_model_final)

# Subset to keep only the estimate and p-value columns
final_model_summary_subset <- final_model_summary[, c("term", "estimate")]

# Change the names
final_model_summary_subset$term <- c("Intercept", "Years of Education", "log(GDP)", "Interaction: Years of Education & log(GDP)")

# Use kable to create a nicely formatted table
kable(final_model_summary_subset, format = "html", digits = 2) %>%
  kable_styling(bootstrap_options = c("striped", "hover"))
```

Interpretation:

- Intercept $B_0$: This is the expected value of the Infant Mortality Rate when all other predictors are zero which is 147.10

- Years of Education $B_1$: For each additional year of education, the Infant Mortality Rate decreases by 8.73

- GDP $B_2$: For every tenfold increase in GDP, the Infant Mortality Rate decreases by 30.45

- Interaction Term $B_4$: The interaction term between Years of Education and log10(GDP) is 1.83, the positive coefficient suggests that the effect of Years of Education and log10(GDP) increases the Infant Mortality Rate, indicating that there is a complex relationship at play here.

```{r}
# Generate predictions for the final model
prediction_final_model <- predict(task1_lm_model_final)

# Plot the predictions vs. actual values
ggplot(data = sdg_clean, aes(x = infant_mortality_rate, y = prediction_final_model)) +
  geom_point(alpha = 0.5) +
  geom_abline(colour = "purple", size = 1, alpha = 0.4) +
  ggtitle("Final Model Predictions vs. Actual") +
  xlab("Actual Infant Mortality Rate") +
  ylab("Predicted Infant Mortality Rate")
```


The plot shows the relationship between the actual and predicted infant mortality rates using this model. The purple line represents the predicted values, which closely align with the actual data points. This indicates that this model is effective in predicting infant mortality rates based on years of education, life expectancy, with interaction terms.

```{r}
# ensure gdp is numeric
sdg_clean$gdp <- as.numeric(sdg_clean$gdp)

# Create a new column for log10(gdp)
sdg_quartile_plot <- sdg_clean %>% 
  mutate(gdp_quartile = log10(gdp))


# Split gdp into 5 quartiles
sdg_quartile_plot$gdp_quartile <- cut(sdg_quartile_plot$gdp_quartile, breaks = quantile(sdg_quartile_plot$gdp_quartile, probs = seq(0, 1, 0.2)), include.lowest = TRUE)

# Plot the relationship between years of education and infant mortality rate by life expectancy quartile
ggplot(data = sdg_quartile_plot, aes(x = years_education, y = infant_mortality_rate, colour = gdp_quartile)) +
  geom_point(alpha = 0.5) +
  geom_smooth(method = "lm", se = F) +
  ggtitle("Years of Education vs. Infant Mortality Rate by log10(GDP) Quartile in USD") +
  xlab("Years of Education") +
  ylab("Infant Mortality Rate") +
  labs(colour = "log10(GDP) Quartile in USD")
```

By splitting the log10(GDP) into 5 different levels, we can see how the relationship between years of education and infant mortality rate varies across different GDP levels. We noticed that the rate of decrease in infant mortality rate with years of education is more pronounced in countries with lower GDP. If GDP is high, as years of education increase, the rate of decrease in infant mortality rate is less pronounced.


```{r}
# Using effects library to get the effect of infant mortality rate
eff_lm_infant <- allEffects(task1_lm_model_final)
plot(eff_lm_infant, multiline = TRUE)
```

This plot illustrates the interaction effects between years of education and GDP on infant mortality rates, depicting how these two variables jointly influence infant mortality across different contexts of life expectancy.

The plot shows multiple lines, each representing a different fixed value of GDP.

As GDP increases, the baseline infant mortality rates start at a lower value. This suggests that in contexts with higher GDP, which may reflect better overall health and social conditions, infant mortality rates are initially lower. It is interesting to note that at higher GDP levels, the lines are flatter and even shows a slight increase if the graph starts with a very low baseline but the increase is very minimal and the slight increase may be attributed to the variability in the data.
 
Conversely, the steeper slopes at lower GDP levels imply that education has a more pronounced effect in reducing infant mortality rates in less developed health contexts.

Thus the effect library has shown a close agreement with our final linear model except for when the baseline is very low.

Next, we explore two additional models: a log-transformed linear model and a Generalised Linear Model (GLM) to predict infant mortality rates.

Log-Transformed Linear Model:

$$
\begin{array}{rcl}
E(\text{infant_mortality_rate}) &=& \exp\left(\beta_0 + \beta_1 \times \text{years_education} + \beta_2 \times \text{log(gdp)} + \beta_3 \times \text{life_expectancy}\right)\\
&& + \beta_4 \times \text{years_education} \times \text{log(gdp)}\\
&& + \beta_5 \times \text{years_education} \times \text{life_expectancy}\\
&& + \beta_6 \times \text{log(gdp)} \times \text{life_expectancy}\\
&& + \beta_7 \times \text{years_education} \times \text{log(gdp)} \times \text{life_expectancy}
\end{array}
$$


```{r}
# Log-Transformed Linear Model
log_lm_infant <- lm(log(infant_mortality_rate) ~ years_education + log(gdp) + life_expectancy + years_education * log(gdp) * life_expectancy, data = sdg_clean)

log_lm_infant_summary <- tidy(log_lm_infant)[, c("term", "estimate", "p.value")]

log_lm_infant_summary$estimate <- signif(log_lm_infant_summary$estimate, digits = 2)
log_lm_infant_summary$p.value <- formatC(log_lm_infant_summary$p.value, format = "e", digits = 2)

# Change the name
log_lm_infant_summary$term <- c("Intercept", "Years of Education", "log(GDP)", "Life Expectancy", "Interaction: Years of Education & log(GDP)", "Interaction: Years of Education & Life Expectancy", "Interactions: log(GDP) & Life Expectancy", "Interactions: Years of Education & log(GDP) & Life Expectancy")

kable(log_lm_infant_summary, format = "html", digits = 2) %>%
  kable_styling(bootstrap_options = c("striped"))
```

```{r}
# Generate predictions for the log-transformed model
prediction_log_lm_infant <- predict(log_lm_infant)
prediction_log_lm_infant_exp <- exp(prediction_log_lm_infant)

ggplot(data = sdg_clean, aes(x = infant_mortality_rate, y = prediction_log_lm_infant_exp)) +
  geom_point(alpha = 0.5) +
  geom_abline(colour = "purple", size = 1, alpha = 0.4) +
  ggtitle("Log-Transformed Linear Model Predictions vs. Actual") +
  xlab("Actual Infant Mortality Rate") +
  ylab("Predicted Infant Mortality Rate")
```


The plots for the log-transformed linear model indicate:

The plot shows the relationship between the actual and predicted infant mortality rates using this model. The purple line represents the predicted values, which closely align with the actual data points. This indicates that this model is effective in predicting infant mortality rates based on years of education, life expectancy, gdp, with interaction terms.

Interpretation:

Since all p-value is less than 0.05, all predictors are statistically significant in the log-transformed linear model. The coefficients indicate the following:

- Intercept $B_0$: This is the expected value of the log-transformed Infant Mortality Rate when all other predictors are zero which is exp(-16.00)

- Years of Education $B_1$: For each additional year of education, the log-transformed Infant Mortality Rate increase by exp(3.80)

- GDP $B_2$: For each additional unit of log-transformed GDP, the log-transformed Infant Mortality Rate increase by exp(3.00)

- Life Expectancy $B_3$: For each additional year of life expectancy, the log-transformed Infant Mortality Rate increase by exp(0.27)

- Interaction between Years of Education and GDP $B_4$: The interaction indicates that the combined increase of education and GDP reduces the mortality rate by a factor of exp(-0.44)

- Interaction between Years of Education and Life Expectancy $B_5$: The interaction indicates that the combined increase of education and life expectancy reduces the mortality rate by a factor of exp(-0.05)

- Interaction between GDP and Life Expectancy $B_6$: The interaction indicates that the combined increase of GDP and life expectancy reduces the mortality rate by a factor of exp(-0.04)

- Triple interaction between Years of Education, GDP, and Life Expectancy $B_7$: The triple interaction indicates that the combined increase of education, GDP, and life expectancy increases the mortality rate by a factor of exp(0.01)


Generalised Linear Model (GLM):

Given the histogram and qqplot has indicated that the infant mortality rate is right-skewed, we can use a Poisson or Negative Binomial distribution to model the relationship between infant mortality rate and other predictors. 

First we check for AIC

```{r}
# GLM
glm_infant_poisson_log <- glm(infant_mortality_rate ~ years_education + log10(gdp) + life_expectancy, data = sdg_clean, family = poisson(link = "log"))
glm_infant_poisson_squareroot <- glm(infant_mortality_rate ~ years_education + log10(gdp) + life_expectancy, data = sdg_clean, family = poisson(link = "sqrt"))
glm_infant_poisson_interaction_log <- glm(infant_mortality_rate ~ years_education * log10(gdp) * life_expectancy, data = sdg_clean, family = poisson(link = "log"))
glm_infant_poisson_interaction_squareroot <- glm(infant_mortality_rate ~ years_education * log10(gdp) * life_expectancy, data = sdg_clean, family = poisson(link = "sqrt"))
glm_infant_negative_binomial_log <- glm.nb(infant_mortality_rate ~ years_education + log10(gdp) + life_expectancy, data = sdg_clean, link = "log")
glm_infant_negative_binomial_squareroot <- glm.nb(infant_mortality_rate ~ years_education + log10(gdp) + life_expectancy, data = sdg_clean, link = "sqrt")
glm_infant_negative_binomial_interaction_log <- glm.nb(infant_mortality_rate ~ years_education * log10(gdp) * life_expectancy, data = sdg_clean, link = "log")
glm_infant_negative_binomial_interaction_squareroot <- glm.nb(infant_mortality_rate ~ years_education * log10(gdp) * life_expectancy, data = sdg_clean, link = "sqrt")
```


```{r}
# Compare AIC values
kable(
  data.frame(Model = c("Poisson with Log link", "Poisson with Square Root link", "Poisson with Interaction and Log link", "Poisson with Interaction and Square Root link", "Negative Binomial with Log link", "Negative Binomial with Square Root link", "Negative Binomial with Interaction and Log link", "Negative Binomial with Interaction and Square Root link"),
             AIC = c(AIC(glm_infant_poisson_log), AIC(glm_infant_poisson_squareroot), AIC(glm_infant_poisson_interaction_log), AIC(glm_infant_poisson_interaction_squareroot), AIC(glm_infant_negative_binomial_log), AIC(glm_infant_negative_binomial_squareroot), AIC(glm_infant_negative_binomial_interaction_log), AIC(glm_infant_negative_binomial_interaction_squareroot))
)) %>% 
  kable_styling(full_width = F)
```

The AIC value indicates that Negative Binomial with a Square Root link function (with interaction) is the best GLM model.

- $\text{Infant Mortality Rate} = \sqrt{(\mu)}$, where $\mu$ is the expected count of infant mortality rate given the predictor

- Link function, $\text{g}(\mu) = \sqrt{(\mu)}$, where $\text{g}()$ is the link function

- Linear predictor,
$$
\begin{array}{rcl}
E(\text{Infant Mortality Rate | Years of Education, GDP, Life Expectancy}) &=& \beta_0 + \beta_1 \times \text{Years of Education} + \beta_2 \times \text{log10(GDP)} + \beta_3 \times \text{Life Expectancy}\\
&& + \beta_4 \times \text{Years of Education} \times \text{log10(GDP)}\\
&& + \beta_5 \times \text{Years of Education} \times \text{Life Expectancy}\\
&& + \beta_6 \times \text{log10(GDP)} \times \text{Life Expectancy}\\
&& + \beta_7 \times \text{Years of Education} \times \text{log10(GDP)} \times \text{Life Expectancy}
\end{array}
$$



```{r}
# Generate predictions for the GLM model
prediction_glm_infant <- predict(glm_infant_negative_binomial_interaction_squareroot, type = "response")

# Plot the predictions vs. actual values
ggplot(data = sdg_clean, aes(x = infant_mortality_rate, y = prediction_glm_infant)) +
  geom_point(alpha = 0.5) +
  geom_abline(colour = "purple", size = 1, alpha = 0.4) +
  ggtitle("GLM Model Predictions vs. Actual") +
  xlab("Actual Infant Mortality Rate") +
  ylab("Predicted Infant Mortality Rate")
```
The plots for the GLM model indicate:

The plot shows the relationship between the actual and predicted infant mortality rates using this model. The purple line represents the predicted values, which closely align with the actual data points. This indicates that this model is effective in predicting infant mortality rates based on years of education, life expectancy, gdp, with interaction terms.

```{r}
# Generate the summary of the GLM model and its coefficients

# only include the estimates
glm_infant_negative_binomial_interaction_squareroot_summary <- tidy(glm_infant_negative_binomial_interaction_squareroot)[, c("term", "estimate")]

# Change the names of the coefficients
glm_infant_negative_binomial_interaction_squareroot_summary$term <- c("Intercept", "Years of Education", "log10(GDP)", "Life Expectancy", "Interaction: Years of Education & log10(GDP)", "Interaction: Years of Education & Life Expectancy", "Interaction: log(GDP) & Life Expectancy", "Triple Interaction: Year of Education & log10(GDP) & Life Expectancy")

# Use kable to create a nicely formatted table
kable(glm_infant_negative_binomial_interaction_squareroot_summary, format = "html", digits = 2) %>%
  kable_styling(bootstrap_options = c("striped", "hover"))
```

Interpretation:

- Intercept $B_0$: This is the expected value of the Infant Mortality Rate when all other predictors are zero which is -22.18

- Years of Education $B_1$: For each additional year of education is associated with an increase in the square root of the expected infant mortality rate by 7.62 units on the logarithmic scale

- GDP $B_2$: For each tenfold increase in GDP, the square root of the expected infant mortality rate increases by 13.13 on the logarithmic scale

- Life Expectancy $B_3$: Each additional year in life expectancy is associated with an increase of 0.35 units in the square root of the expected infant mortality rate on the logarithmic scale

- Interaction between Years of Education and GDP $B_4$: The interaction term between Years of Education and log10(GDP) is -2.26, suggesting that the combined effect of education and log(GDP) on infant mortality rate differs from the effect of either of these variables alone. Specifically, the negative coefficient indicates that higher GDP diminishes the positive effect of education on the infant mortality rate.

- Interaction between Years of Education and Life Expectancy $B_5$: The interaction term between Years of Education and Life Expectancy is -0.10, a small negative effect, implying that the combined increase in years of education and life expectancy has a slightly mitigating effect on the positive association of each individual factor with infant mortality rates.

- Interaction between GDP and Life Expectancy $B_6$: The interaction term between log10(GDP) and Life Expectancy is -0.17, indicating that the interaction between GDP and life expectancy decreases the square root of the expected infant mortality rate.

- Triple interaction between Years of Education, GDP, and Life Expectancy $B_7$: The triple interaction term is 0.03. This three-way interaction term suggests a slight positive effect when all three variables increase together, contrasting with some of the negative two-way interactions.



```{r, fig.width = 12, fig.height = 10}
# Generate the effect of infant mortality rate
eff_glm_infant <- allEffects(glm_infant_negative_binomial_interaction_squareroot)
plot(eff_glm_infant, multiline = TRUE)
```

- Impact of Life Expectancy: Panels with higher life expectancy (77, 84 years) generally show lower rates of infant mortality across all levels of education and GDP, indicating a strong negative correlation between life expectancy and infant mortality rates except for a few exceptions in the panel with a life expectancy of 84 years which shows a slight increase in infant mortality rates at higher levels of education.

- Impact of Education: In panels with lower life expectancy (57, 64, and 70 years), an increase in years of education seems to have a more pronounced decrease in infant mortality rates. This trend is less steep or almost flat in panels with higher life expectancy. The only exception is the blue line that increases as years of education increase. This shows that in our GLM model, the impact of GDP will influence the relationship between education and infant mortality rates at different levels.

- The impact of increasing years of education on reducing infant mortality rates varies significantly with changes in GDP levels. For example, in the panel with a life expectancy of 57 years, the differences between GDP levels are more marked as education increases. Conversely, at a life expectancy of 84 years, the GDP lines are closely clustered together, suggesting that higher life expectancy might mitigate the relative impact of GDP and education differences.


## Task 1 Conclusion

These findings suggest that investing in education, healthcare, and overall economy will have positive effects on reducing infant mortality rates across different countries and income classifications. â€‹



# Wine data

## Cleaning the dataset

```{r}
# Use janitor to clean the data
wine_clean <- Wine %>%
  clean_names() %>%
  remove_empty(c("rows", "cols"))

# Make year to be numeric
wine_clean$year <- as.numeric(wine_clean$year)

# check unique values in the year column
# unique(wine_clean$year)
```
```{r}
# remove the year column with "N.V." values
wine_clean_year <- wine_clean %>%
  filter(year != "N.V.")
```

## Performing Exploratory Data Analysis

```{r}
# Distribution of wine ratings
ggplot(data = wine_clean_year, aes(x=rating)) +
  geom_histogram(binwidth=0.1, fill="yellow", color="gray", alpha=0.7) +
  labs(title="Distribution of Wine Ratings", x="Rating", y="Frequency")
```
```{r}
ggplot(data = wine_clean_year,
       aes(x = rating, y = number_of_ratings, colour = variety)) + 
  geom_point(alpha = 0.5)
```

Distribution of Wine Ratings shows a normal distribution with a peak around 3.8. This indicates that most wines have ratings around 3.8, with fewer wines having higher or lower ratings.

```{r}
# Use qqplot to check the distribution of wine ratings
qqnorm(wine_clean_year$rating)
qqline(wine_clean_year$rating)
```

Given the histogram and qq-plot which has very minor skewness, a Gaussian distribution is an appropriate choice for GLM modelling in later section.

Before that, we attempt to find the relationship between wine ratings and other variables such as wine variety, country, price, and number of ratings.

```{r}
# Plot the relationship between rating and wine variety
ggplot(wine_clean_year, aes(x = variety, y = rating)) +
  geom_boxplot(color = "black", aes(fill = variety)) +
  scale_fill_manual(values = c("White" = "yellow", "Sparkling" = "orange", 
                               "Red" = "red", "Rose" = "magenta")) +
  labs(title = "Ratings by Wine Variety", x = "Variety", y = "Rating")
```

While Sparkling wines has the overall highest ratings, the differences between variety aren't very pronounce.

```{r, fig.width = 12, fig.height = 8}
# Rating by country
ggplot(wine_clean_year, aes(x = country, y = rating)) +
  geom_boxplot(color = "black", aes(fill = country)) +
  labs(title = "Ratings by Country", x = "Country", y = "Rating") +
  theme(axis.text.x = element_text(angle = 90, hjust = 1), legend.position = "bottom")
```

The boxplot shows the distribution of wine ratings by country. The ratings are relatively consistent across different countries within the 3.0 to 4.5 range. Indicating that no country has a significant advantage (monopoly) over its counterparts in terms of wine ratings.


```{r}
# Explore how rating correlate with price of wine
ggplot(data = wine_clean_year, aes(x=price, y=rating)) +
  geom_point(alpha=0.3) +
  geom_smooth(method="loess", se=FALSE, size = 1.5, colour = "red") +
  scale_x_log10() +
  labs(title="Ratings vs. Price", x="Price (Euros)", y="Rating")
```

The plot shows a positive correlation between the price of wine and its rating. As the price of wine increases, the rating also tends to increase. The LOESS curve provides a smooth fit to the data, capturing the general trend of the relationship between price and rating. The LOESS curve shows a logarithmic behaviour, indicating that after a certain point, the marginal increase in rating decreases as the price continues to increase.

To aid our analysis, we find how the price of wine varies with the year and variety of wine. We will use a linear regression model to predict the price of wine based on the year and variety of wine.

$E(Price | Year, Variety) = \beta_0 + \beta_1 \times \text{Year} + \zeta_{\text{Red}} \times Variety_{Red} + \zeta_{\text{Rose}} \times Variety_{Rose} + \zeta_{\text{Sparkling}} \times Variety_{Sparkling} + \zeta_{\text{White}} \times Variety_{White}$

```{r, fig.width = 12, fig.height = 8}
# remove the outlier in "Sparkling" variety with year < 1980
wine_clean_year_special_case <- wine_clean_year %>%
  filter(!(variety == "Sparkling" & year < 1980)) 
```

```{r} 
# Linear regression model for 'Price' and 'Year' for different 'Varieties' with shared y-axis limits
ggplot(wine_clean_year_special_case, aes(x = year, y = price, color = variety)) +
  geom_point(alpha = 0.5) +
  geom_smooth(method = "lm", se = FALSE, aes(colour = variety), formula = y ~ x) +
  facet_wrap(~ variety, scales = "free_x") +
  labs(title = "Linear Regression: Price vs. Year for Different Varieties",
       x = "Year",
       y = "Price") +
  theme(axis.text.x = element_text(angle = 45, hjust = 1),
        legend.position = "none") +
  coord_cartesian(ylim = c(0, 300))

# Linear model for 'Price' and 'Year' for different 'Varieties'
# lm_price_year_variety <- lm(price ~ year + variety - 1, data = wine_clean_year_special_case)
# summary(lm_price_year_variety)
```

The graphs shows us that Red, Sparkling, and White's prices have decrease over the years while Rose's price remains with little changes.

Next, we attempt to find if Number of Ratings has an effect on Ratings of wine.

```{r}
# Explore how rating correlate with number of ratings
ggplot(data = wine_clean_year, aes(x=log(number_of_ratings), y=rating)) +
  geom_point(alpha=0.3) +
  geom_smooth(method = "loess", se=FALSE, size = 1.5, colour = "red") +
  labs(title="Ratings vs. Number of Ratings", x="Number of Ratings", y="Rating")
```

The LOESS curve shows a very slight increase in rating as the number of ratings increases. This indicates that popular wines with more ratings tend to have slightly higher ratings, but the relationship is not very strong.

```{r, fig.width = 12, fig.height = 5}
# Remove the 2 outliers by keeping the year range after 1980
wine_after_year_1980 <- wine_clean_year %>%
  filter(year >= 1980)

# Explore the ratings over the years
ggplot(data = wine_after_year_1980, aes(x=year, y=rating, colour=variety)) +
  geom_point(alpha=0.8) +
  # geom_line() +
  geom_smooth(method="loess", se=FALSE, size = 1.2) +
  labs(title="Ratings over the Years", x="Year", y="Rating") +
  theme(axis.text.x = element_text(angle = 45, hjust = 1))
```

Red, sparkling, and white variety have shown a graduate decline over the years, only sparkling and white begin to recover around 2015 and 2018 respectively. We only have data for the rose variety from 2012 onwards, its rating does not change significantly over the years and only experiencing a slight increase in 2018.

This is useful information as when we consider that the price of wine decreasing over the years may be the reason why the ratings of the three wines have also decreased over the years per our previous EDA.


## Regression models

There are a few possible linear regression model to consider to test if the price of wine is related to the rating of wine:

- Model 1: 

$$E(\text{Rating | Price}) = \beta_0 + \beta_1 \times \log10(\text{Price})$$

- Model 2:

$$
\begin{array}{rcl}
E(\text{Rating | Price, Number of Ratings}) &=& \beta_0 + \beta_1 \times \log10(\text{Price})\\
&& + \beta_2 \times \log10(\text{NumberofRatings})
\end{array}
$$

- Model 3:

$$
\begin{array}{rcl}
E(\text{Rating | Price, Number of Ratings}) &=& \beta_0 + \beta_1 \times \log10(\text{Price})\\
&& + \beta_2 \times \log10(\text{NumberofRatings})\\
&& + \beta_3 \times \log10(\text{Price}) \times \log10(\text{NumberofRatings})
\end{array}
$$

```{r}
# Find the AIC and R-squared values for the models
task2_model1 <- lm(rating ~ log10(price), data = wine_clean_year)
task2_model2 <- lm(rating ~ log10(price) + log10(number_of_ratings), data = wine_clean_year)
task2_model3 <- lm(rating ~ log10(price) + log10(number_of_ratings) + log10(price) * log10(number_of_ratings), data = wine_clean_year)

kable(
  data.frame(Model = c("Model 1", "Model 2", "Model 3"),
             AIC = c(AIC(task2_model1), AIC(task2_model2), AIC(task2_model3)),
             R_squared = c(summary(task2_model1)$r.squared, summary(task2_model2)$r.squared, summary(task2_model3)$r.squared))) %>% 
  kable_styling(full_width = F)
```

We will go with Model 3 as it has the lowest AIC value and the highest R-squared value.

We consider a linear regression on 'Price' and 'NumberofRatings' as predictors of 'Rating' to find out if the number of ratings has an effect on the rating of wine.

$E(\text{Rating | Price, Number of Rating}) = \beta_0 + \beta_1 \times \log10(\text{Price}) + \beta_2 \times \log10(\text{NumberofRatings}) + \beta_3 \times \log10(\text{Price}) \times \log10(\text{NumberofRatings})$

```{r}
# Linear regression model with Price and NumberofRatings as predictors
lm_wine_price_ratings <- lm(rating ~ log10(price) + log10(number_of_ratings) + log10(price) * log10(number_of_ratings), data = wine_clean_year)

lm_wine_price_ratings_summary <- tidy(lm_wine_price_ratings)[, c("term", "estimate")]

lm_wine_price_ratings_summary$term <- c("Intercept", "Price", "Number of Ratings", "Interaction: Price & Number of Ratings")

lm_wine_price_ratings_summary$estimate <- signif(lm_wine_price_ratings_summary$estimate, digits = 2)

kable(lm_wine_price_ratings_summary, format = "html", digits = 2) %>%
  kable_styling(bootstrap_options = c("striped"))
```

The linear regression model on 'Rating' using log(Price) and log(Number of Ratings) as predictors can be expressed as

$E(\text{Rating}) = 3.00 + 0.62 \times \log10(\text{Price}) + 0.07 \times \log10(\text{NumberofRatings}) - 0.02 \times \log10(\text{Price}) \times \log10(\text{NumberofRatings})$

Interpretation:

- Intercept $B_0$: This is the expected value of the rating when both log(Price) and log(Number of Ratings) are zero, which is 3.00

- Price $B_1$: For every one unit increase in the logarithm of the price, the wine rating is expected to increase by 0.62 points

- Number of Ratings $B_2$: For every one unit increase in the logarithm of the number of ratings, the wine rating is expected to increase by 0.07 points

- Interaction between Price and Number of Ratings $B_3$: The interaction term between log(Price) and log(Number of Ratings) is -0.02, suggesting that the combined effect of price and number of ratings on the rating differs from the effect of either of these variables alone.



```{r}
# Generate predictions for the linear model with Price and NumberofRatings as predictors
prediction_lm_wine_price_ratings <- predict(lm_wine_price_ratings)

ggplot(data = wine_clean_year, aes(x = rating, y = prediction_lm_wine_price_ratings)) +
  geom_point(alpha = 0.5) +
  geom_smooth(method = "loess", se = FALSE, colour = "red") +
  ggtitle("Linear Model with Price and Number of Ratings Predictions vs. Actual") +
  xlab("Actual Rating") +
  ylab("Predicted Rating")
```

The plot shows the relationship between the actual and predicted ratings using the linear model with Price and Number of Ratings as predictors. The red line represents the predicted values, which closely align with the actual data points. The LOESS model provides a good fit for the data, capturing the general trend of the relationship between price, number of ratings, and rating.


GLM Gaussian Model:

Given our histograms in our EDA section showing a normal distribution of ratings, we can use a Gaussian GLM model to analyse the dataset.

We can either use a Gaussian GLM with identity link or log link. To determine, we check for AIC as well as plot the residuals.

The 6 models are

- Model 1: Gaussian GLM with identity link and Price as predictor

- Model 2: Gaussian GLM with identity link and Price and Number of Ratings as predictors

- Model 3: Gaussian GLM with identity link and Price, Number of Ratings, and their interaction as predictors

- Model 4: Gaussian GLM with log link and Price as predictor

- Model 5: Gaussian GLM with log link and Price and Number of Ratings as predictors

- Model 6: Gaussian GLM with log link and Price, Number of Ratings, and their interaction as predictors

```{r}
# Gaussian GLM with identity link
glm_model_1 <- glm(rating ~ log10(price), data = wine_clean_year, family = gaussian(link = "identity"))
glm_model_2 <- glm(rating ~ log10(price) + log10(number_of_ratings), data = wine_clean_year, family = gaussian(link = "identity"))
glm_model_3 <- glm(rating ~ log10(price) + log10(number_of_ratings) + log10(price) * log10(number_of_ratings), data = wine_clean_year, family = gaussian(link = "identity"))
glm_model_4 <- glm(rating ~ log10(price), data = wine_clean_year, family = gaussian(link = "log"))
glm_model_5 <- glm(rating ~ log10(price) + log10(number_of_ratings), data = wine_clean_year, family = gaussian(link = "log"))
glm_model_6 <- glm(rating ~ log10(price) + log10(number_of_ratings) + log10(price) * log10(number_of_ratings), data = wine_clean_year, family = gaussian(link = "log"))
```


QQ plots for the 6 models

Model 1:
```{r}
qqnorm(residuals(glm_model_1))
qqline(residuals(glm_model_1))
```

Model 2:
```{r}
# <!-- qqnorm(residuals(glm_model_2)) -->
# <!-- qqline(residuals(glm_model_2)) -->
```

Model 3:
```{r}
qqnorm(residuals(glm_model_3))
qqline(residuals(glm_model_3))
```

Model 4:
```{r}
qqnorm(residuals(glm_model_4))
qqline(residuals(glm_model_4))
```

Model 5:
```{r}
qqnorm(residuals(glm_model_5))
qqline(residuals(glm_model_5))
```

Model 6:
```{r}
qqnorm(residuals(glm_model_6))
qqline(residuals(glm_model_6))
```


From the QQ plots, we can see that the residuals in all 6 plots mostly fit the straight line with minor skewness. This suggests that the Gaussian GLM models with either log or identity links are appropriate for the dataset. Thus, we use AIC to determine the preferred model.


```{r}
# Generate a table with AIC and R-squared values
kable(data.frame(Model = c("Model 1", "Model 2", "Model 3", "Model 4", "Model 5", "Model 6"),
                 AIC = c(AIC(glm_model_1), AIC(glm_model_2), AIC(glm_model_3), AIC(glm_model_4), AIC(glm_model_5), AIC(glm_model_6)))) %>% 
  kable_styling(full_width = F)
```

From the AIC comparison, model 3 has the lowest AIC. We will then use this a Gaussian with identity link as our GLM model for analysis.

$$
\begin{array}{rcl}
E(\text{Rating | Price, Number of Ratings}) &=& \beta_0 + \beta_1 \times \log10(\text{Price})\\
&& + \beta_2 \times \log10(\text{NumberofRatings})\\
&& + \beta_3 \times \log10(\text{Price}) \times \log10(\text{NumberofRatings}) + \epsilon
\end{array}
$$

```{r} 
# Generate predictions for the preferred GLM Gaussian model
prediction_glm_model_task_2 <- predict(glm_model_3)

ggplot(data = wine_clean_year, aes(x = rating, y = prediction_glm_model_task_2)) +
  geom_point(alpha = 0.5) +
  geom_smooth(method = "loess", se = FALSE, colour = "red") +
  ggtitle("GLM Gaussian Model Predictions vs. Actual") +
  xlab("Actual Rating") +
  ylab("Predicted Rating")
```

The plot shows the relationship between the actual and predicted ratings using the preferred GLM Gaussian model. The red line represents the predicted values, which closely align with the actual data points. The LOESS model provides a good fit for the data, capturing the general trend of the relationship between price, number of ratings, and rating.

```{r}
glm_model_3 <- glm(rating ~ log10(price) + log10(number_of_ratings) + log10(price) * log10(number_of_ratings), data = wine_clean_year, family = gaussian(link = "identity"))
# Generate the summary of the GLM Gaussian model and its coefficients
glm_model_3_summary <- tidy(glm_model_3)[, c("term", "estimate")]

glm_model_3_summary$term <- c("Intercept", "log10(Price)", "log10(Number of Ratings)", "Interaction: log10(Price) & log10(Number of Ratings)")

glm_model_3_summary$estimate <- signif(glm_model_3_summary$estimate, digits = 2)


kable(glm_model_3_summary, format = "html", digits = 2) %>%
  kable_styling(bootstrap_options = c("striped"))
```

Interpretation:

- Intercept $B_0$: This is the expected value of the rating when both log(Price) and log(Number of Ratings) are zero. Since these terms are log-transformed, a value of zero corresponds to the log of 1, so this is when both price and number of ratings are 1. Thus, when the price and the number of ratings are at their minimum (1), the predicted rating is 3.00

- Price $B_1$: For every tenfold increase in the price, the rating is expected to increase by 0.62 points

- Number of Ratings $B_2$: For every tenfold increase in the number of ratings, the rating is expected to increase by 0.07 points

- Interaction between Price and Number of Ratings $B_3$: The interaction term between log(Price) and log(Number of Ratings) is -0.02, suggesting that the combined effect of price and number of ratings on the rating differs from the effect of either of these variables alone. Specifically, the negative sign suggests that the positive impact of increasing either price or number of ratings on wine ratings is less pronounced when the other variable is also high. This can be understood as a kind of diminishing returns or counteractive effect: as more ratings are accumulated, the additional positive impact of price on rating becomes smaller, and as prices rise, the additional positive impact of increasing the number of ratings also diminishes.


```{r, fig.width = 12, fig.height = 8}
# Using effects library to get the effect of log(price) and log(number_of_ratings)
eff_glm_model_task2 <- allEffects(glm_model_3)
plot(eff_glm_model_task2, main = "Effect of Log(Price) and Log(Number of Ratings) on Rating")
```

The provided plots depict the effects of price on wine ratings at different levels of the number of ratings. These plots are generated using a GLM with interaction terms, and the predictions are shown across varying prices and fixed numbers of ratings, indicating how the relationship between price and ratings changes as the number of ratings increases.

- As price increases, rating increases but the rate of increment slows down after a certain point of price rise. The behaviour is logarithmic, indicating that the marginal increase in rating decreases as the price continues to increase after a certain point and began to show diminishing returns.

- For low number of ratings (25 and 5100), the starting baseline rating is lower than those of moderate to large number of ratings (10000, 15000, 20000). However, as price rises, the rating increases in a similar manner and diminishing returns are observed across all pass a certain price threshold.

## Task 2 Conclusion

- For popular wine with many ratings are generally trusted or perceived to be of better quality at lower price points.

- As price increases, we expect an increase in rating as well but up to a certain point only as diminishing returns occurs past a certain threshold, this suggests that there is a limit to how much increasing the price can influence the rating of a wine.

This indicates that the price of wine is not the only factor that determines the rating of wine, and other factors such as the number of ratings also play a significant role in influencing the rating of wine as well.


# References

```{=html}
<!--
Include your references in this section. The ones below are just examples.
-->
```
1.  Wickham, H. *ggplot2: Elegant Graphics for Data Analysis* [on-line version](https://ggplot2-book.org/index.html)

2.  Wickham, H. & Grolemund, G. *R for Data Science.* [on-line version](https://r4ds.had.co.nz/index.html)

3.  https://www.graphpad.com/support/faq/testing-data-for-normal-distrbution/

4.  https://www.statology.org/q-q-plot-normality/

\`\`\`{r}
